=head1 NAME

perldelta - what is new for perl v5.8.8

=head1 DESCRIPTION

This document describes differences between the 5.8.7 release and
the 5.8.8 release.

=head1 Incompatible Changes

There are no changes intentionally incompatible with 5.8.7. If any exist,
they are bugs and reports are welcome.

=head1 Core Enhancements

=head1 Modules and Pragmata

=over

=item *

Attribute::Handlers upgraded to version 0.78_02

=over

=item *

documentation typo fix

=back

=item *

attrs upgraded to version 1.02

=over

=item *

internal cleanup only

=back

=item *

autouse upgraded to version 1.05

=over

=item *

simplified implementation

=back

=item *

B upgraded to version 1.09_01

=over

=item *

The inheritance hierarchy of the C<B::> modules has been corrected;
C<B::NV> now inherits from C<B::SV> (instead of C<B::IV>).

=back

=item *

blib upgraded to version 1.03

=over

=item *

documentation typo fix

=back

=item *

ByteLoader upgraded to version 0.06

=over

=item *

internal cleanup

=back

=item *

CGI upgraded to version 3.15

=over

=item *

Extraneous "?" from self_url() removed

=item *

scrolling_list() select attribute fixed

=item *

virtual_port now works properly with https protocol

=item *

upload_hook() and append() now works in function-oriented mode

=item *

POST_MAX doesn't cause client to hang any more

=item *

automatic tab indexes are now disabled and new C<-tabindex> pragma has
been added to turn automatic indexes back on

=item *

end_form() doesn't emit empty (and non-validating) <div>

=item *

CGI::Carp works better in certain mod_perl configurations

=item *

Setting $CGI::TMPDIRECTORY  is now effective

=item *

enhanced documentation

=back

=item *

charnames upgraded to version 1.05

=over

=item *

viacode() now accept hex strings and is better optimized.

=back

=item *

CPAN upgraded to version 1.83

=over

=item *

Support for C<Module::Build>

=item *

Support for C<bzip2>

=item *

Support for Module::Signature

=item *

Support for C<SHA256>

=item *

Support for C<curl>

=item *

Support for C<sudo>

=item *

new pragma C<notest>

=item *

New commands C<recent> and C<perldoc>

=item *

New feature <show_upload_date>

=item *

C<CPAN::Version> (improved support for multi-dot version notation)

=item *

Improved config variable handling

=item *

Improved C<wget> support on Win32

=back

=item *

Cwd upgraded to version 3.12

=over

=item *

canonpath() on Win32 now collapses F<foo\..> sections correctly.

=item *

Improved behaviour on Symbian OS.

=item *

enhanced documentation and typo fixes

=item *

internal cleanup

=back

=item *

Data::Dumper upgraded to version 2.121_08

=over

=item *

problem where Data::Dumper would sometimes update the iterator state
of hashes has been fixed

=item *

numeric labels now work

=item *

internal cleanup

=back

=item *

DB upgraded to version 1.01

=over

=item *

problem where regex state would sometimes get clobbered when running
under the debugger has been fixed

=back

=item *

DB_File upgraded to version 1.814

=over

=item * 

adds support for Berkeley DB 4.4.

=back

=item *

Devel::DProf upgraded to version 20050603.00

=over

=item *

internal cleanup

=back

=item *

Devel::Peek upgraded to version 1.03

=over

=item *

internal cleanup

=back

=item *

Devel::PPPort upgraded to version 3.06_01

=over

=item *

C<--compat-version> argument checking has been improved

=item *

files passed on the command line are filtered by default

=item *

C<--nofilter> option to override the filtering has been added

=item *

enhanced documentation

=back

=item *

diagnostics upgraded to version 1.15

=over

=item *

documentation typo fix

=back

=item *

Digest upgraded to version 1.14

=over

=item *

constructor now knows which module implement SHA-224

=item *

documentation tweaks and typo fixes

=back

=item *

Digest::MD5 upgraded to version 2.36

=over

=item *

XSLoader is now used for faster loading

=item *

enhanced documentation including MD5 weaknesses discovered lately

=back

=item *

Dumpvalue upgraded to version 1.12

=over

=item *

documentation fix

=back

=item *

DynaLoader upgraded but unfortunately we're not able to increment its version number :-(

=over

=item *

implements C<dl_unload_file> on Win32

=item *

internal cleanup

=item *

XSLoader 0.06 incorporated; small optimisation for calling
bootstrap_inherit() and documentation enhancements.

=back

=item *

Encode upgraded to version 2.12

=over

=item *

coderef now acceptable for CHECK!

=item *

3 new characters added to the ISO-8859-7 encoding

=item *

new encodings C<MIME-Header-ISO_2022_JP> added

=item *

problem with partial character and C<< encoding(utf-8-strict) >> fixed.

=item *

documentation enhancements and typo fixes

=back

=item *

English upgraded to version 1.02

=over

=item *

the C<< $COMPILING >> variable has been added

=back

=item *

ExtUtils::Constant upgraded to version 0.17

=over

=item *

improved compatibility with older versions of perl

=back

=item *

ExtUtils::MakeMaker upgraded to version 6.30 (was 6.17)

=over

=item *

Too much to list here;  see L<http://search.cpan.org/src/MSCHWERN/ExtUtils-MakeMaker-6.30/Changes>

=back

=item *

File::Basename upgraded to version 2.74, with changes contributed by Schwern.

=over

=item *

Documentation clarified and errors corrected.

=item *

C<basename> now strips trailing path seperators before processing the name.

=item *

C<basename> now returns C</> for parameter C</>, which makes C<basename>
consistent with the shell utility of the same name.

=item *

The suffix is now not stripped if it is identical to the remaining characters
in the name, again for consistency with the shell utility.

=item *

Some internal code cleanup.

=back

=item *

File::Copy upgraded to version 2.09

=over

=item *

copy a file onto itself used to fail.

=item *

moving a file between file systems now preserves the access and
modification time stamps

=back

=item *

File::Find upgraded to version 1.10

=over

=item *

windows portability fixes

=item *

enhanced documentation

=back

=item *

File::Glob upgraded to version 1.05

=over

=item *

internal cleanup

=back

=item *

File::Path upgraded to version 1.08

=over

=item *

mkpath now preserves errno when mkdir fails

=back

=item *

File::Spec upgraded to version 3.12

=over

=item *

File::Spec->rootdir() now returns C<\> on Win32, instead of C</>

=item *

C<$^O> could sometimes become tainted. This has been fixed.

=item *

C<canonpath> on Win32 now collapses C<foo/..> (or C<foo\..>) sections
correctly, rather than doing the "misguided" work it was previously doing.
Note that C<canonpath> on Unix still does B<not> collapse these sections, as
doing so would be incorrect.

=item *

Some documentation improvements

=item *

Some internal code cleanup

=back

=item *

FileCache upgraded to version 1.06

=over

=item *

POD formatting error in documentation fixed

=back

=item *

Filter::Simple upgraded to version 0.82

=item *

FindBin upgraded to version 1.47

=over

=item *

now works better with directories where access rights are more
restrictive than usual.

=back

=item *

GDBM_File upgraded to version 1.08

=over

=item *

internal cleanup

=back

=item *

Getopt::Long upgraded to version 2.35

=over

=item *

C<prefix_pattern> has now been complemented by a new configuration
option C<long_prefix_pattern> that allows the user to specify what
prefix patterns should have long option style semantics applied.

=item *

options can now take multiple values at once (experimental)

=item *

various bug fixes

=back

=item *

if upgraded to version 0.05

=over

=item *

give more meaningful error messages from if.pm when invoked with a
condition in list context.

=item *

restore backwards compatibility with earlier versions of perl

=back

=item *

IO upgraded to version 1.22

=over

=item *

enhanced documentation

=item *

internal cleanup

=back

=item *

IPC::Open2 upgraded to version 1.02

=over

=item *

enhanced documentation

=back

=item *

IPC::Open3 upgraded to version 1.02

=over

=item *

enhanced documentation

=back

=item *

List::Util upgraded to version 1.18 (was 1.14)

=over

=item *

fix pure-perl version of refaddr to avoid blessing an un-blessed reference

=item *

use XSLoader for faster loading

=item *

fixed various memory leaks

=item *

internal cleanup and portability fixes

=back

=item *

Math::Complex upgraded to version 1.35

=over

=item *

atan2(0, i) now works, as do all the (computable) complex argument cases

=item *

fixes for certain bugs in C<make> and C<emake>

=item *

support returning the I<k>th root directly

=item *

support [2,-3pi/8] in C<emake>

=item *

support 'inf' for C<make>/C<emake>

=item *

document C<make>/C<emake> more visibly

=back

=item *

Math::Trig upgraded to version 1.03

=over

=item *

add more great circle routines: C<great_circle_waypoint> an
C<great_circle_destination>

=back

=item *

MIME::Base64 upgraded to version 3.07

=over

=item *

use XSLoader for faster loading

=item *

enhanced documentation

=item *

internal cleanup

=back

=item *

NDBM_File upgraded to version 1.06

=over

=item *

enhanced documentation

=back

=item *

ODBM_File upgraded to version 1.06

=over

=item *

documentation typo fixed

=item *

internal cleanup

=back

=item *

Opcode upgraded to version 1.06

=over

=item *

enhanced documentation

=item *

internal cleanup

=back

=item *

open upgraded to version 1.05

=over

=item *

enhanced documentation

=back

=item *

overload upgraded to version 1.04

=over

=item *

enhanced documentation

=back

=item *

PerlIO upgraded to version 1.04

=over

=item *

PerlIO::via iterate over layers properly now

=item *

PerlIO::scalar understands C<< $/ = "" >> now

=item *

encoding(utf-8-strict) with partial characters now work

=item *

enhanced documentation

=item *

internal cleanup

=back

=item *

Pod::Functions upgraded to version 1.03

=over

=item *

documentation typos fixed

=back

=item *

Pod::Html upgraded to version 1.0504

=over

=item *

HTML output will now correctly link
to C<=item>s on the same page, and should be valid XHTML.

=item *

Variable names are recognized as intended

=item *

documentation typos fixed

=back

=item *

Pod::Parser upgraded to version 1.32

=over

=item *

allow files that start with =head on the first line

=item *

windows portability fix

=item *

exit status of pod2usage fixed

=item *

New C<-noperldoc> switch to pod2usage

=item *

arbitrary URL schemes now allowed

=item *

documentation typos fixed

=back

=item *

POSIX upgraded to version 1.09

=over

=item *

documentation typos fixed

=item *

internal cleanup

=back

=item *

re upgraded to version 0.05

=over

=item *

documentation typo fixed

=back

=item *

Safe upgraded to version 2.12

=over

=item *

minor documentation enhancement

=back

=item *

SDBM_File upgraded to version 1.05

=over

=item *

documentation typo fixed

=item *

internal cleanup

=back

=item *

Socket upgraded to version 1.78

=over

=item *

internal cleanup

=back

=item *

Storable upgraded to version 2.15

=over

=item *

This includes C<STORABLE_attach> hook functionality added by
Adam Kennedy, and more memory frugal storing under ithreads, by
utilising the ithreads cloning tracking code.

=back

=item *

Switch upgraded to version 2.10_01

=over

=item *

documentation typos fixed

=back

=item *

Sys::Syslog upgraded to version 0.13

=over

=item *

Now provides numeric macros and meaningful C<Exporter> tags.

=item *

No longer uses C<Sys::Hostname> as it may provide useless values in
unconfigured network environments, so instead directly uses C<INADDR_LOOPBACK>.

=item *

C<syslog()> now uses local timestamp.

=item *

C<setlogmask()> now behaves like its C counterpart.

=item *

C<setlogsock()> will now C<croak()> as documented.

=item *

Improved error and warnings messages.

=item *

Improved documentation.

=back

=item *

Term::ANSIColor upgraded to version 1.10
 
=over

=item *

Fixes a bug in C<colored> when C<$EACHLINE> is set that caused it to not color
lines consisting solely of 0.

=item *

Improved tests.

=back

=item *

Term::ReadLine upgraded to version 1.02

=over

=item *

documentation tweaks

=back

=item *

Test::Harness upgraded to version 2.56 (was 2.48)

=over

=item *

The Test::Harness timer is now off by default.

=item *

Now shows elapsed time in milliseconds.

=item *

various bug fixes

=back

=item *

Test::Simple upgraded to version 0.62 (was 0.54)

=over

=item *

is_deeply() failed to work for many cases

=item *

various minor bug fixes

=item *

documentation enhancements

=back

=item *

Text::Tabs upgraded to version 2005.0824
 
=over

=item *

Provides a faster implementation of C<expand>

=back

=item *

Text::Wrap upgraded to version 2005.082401
 
=over

=item *

Adds C<$Text::Wrap::separator2>, which allows you to preserve existing newlines
but add line-breaks with some other string.

=back

=item *

threads upgraded to version 1.07

=over

=item *

threads will now honour C<no warnings 'threads'>

=item *

A thread's interpreter is now freed after C<$t->join()> rather than after
C<undef $t>, which should fix some ithreads memory leaks. (Fixed by Dave
Mitchell)

=item *

Some documentation typo fixes.

=back

=item *

threads::shared upgraded to version 0.94

=over

=item *

documentation changes only

=item *

Note: An improved implementation of C<threads::shared> is available on
CPAN - this will be merged into 5.8.9 if it proves stable.

=back

=item *

Tie::Hash upgraded to version 1.02

=over

=item *

documentation typo fixed

=back

=item *

Time::HiRes upgraded to version 1.86 (was 1.66)

=over

=item *

clock_nanosleep() and clock() functions added

=item *

support for the POSIX clock_gettime() and clock_getres() has been added

=item *

return undef or an empty if the C gettimeofday() fails

=item *

improved nanosleep detection

=item *

internal cleanup

=item *

enhanced documentation

=back

=item *

Unicode::Collate upgraded to version 0.52

=over

=item *

Now implements UCA Revision 14 (based on Unicode 4.1.0).

=item *

Unicode::Collate->new method no longer destroys user's $_

=item *

enhanced documentation

=back

=item *

Unicode::UCD upgraded to version 0.24

=over

=item *

documentation typos fixed

=back

=item *

User::grent upgraded to version 1.01

=over

=item *

documentation typo fixed

=back

=item *

utf8 upgraded to version 1.06

=over

=item *

documentation typos fixed

=back

=item *

vmsish upgraded to version 1.02

=over

=item *

documentation typos fixed

=back

=item *

warnings upgraded to version 1.05

=over

=item *

gentler messing with Carp:: internals

=item *

internal cleanup

=item *

documentation update

=back

=item *

Win32 upgraded to version 0.2601

=for cynics And how many perl 5.8.x versions can I release ahead of Vista?

=over

=item *

provides Windows Vista support to C<Win32::GetOSName>

=item *

documentation enhancements

=back

=item *

XS::Typemap upgraded to version 0.02

=over

=item *

internal cleanup

=back

=back

=head1 Utility Changes

=head2 h2xs enhancements

C<h2xs> implements new option C<--use-xsloader> to force use of
C<XSLoader> even in backward compatible modules.

The handling of authors' names that had apostrophes has been fixed.

Any enums with negative values are now skipped.

=head2 perlivp enhancements

C<perlivp> implement new option C<-a> and will not check for F<*.ph>
files by default any more.  Use the C<-a> option to run I<all> tests.

=head1 New Documentation

The L<perlglossary> manpage is a glossary of terms used in the Perl
documentation, technical and otherwise, kindly provided by O'Reilly Media,
inc.

=head1 Performance Enhancements

=over 4

=item *

The default since perl 5.000 has been for perl to create an empty scalar
with every new typeglob. The increased use of lexical variables means that
most are now unused. Thanks to Nicholas Clark's efforts, Perl can now be
compiled with C<-DPERL_DONT_CREATE_GVSV> to avoid creating these empty scalars.
This will significantly decrease the number of scalars allocated for all
configurations, and the number of scalars that need to be copied for ithread
creation. Whilst this option is binary compatible with existing perl
installations, it does change a long-standing previous assumption about the
internals, hence it is not enabled by default, as some third party code may
rely on the old behaviour.

We would recommend testing with this configuration on new deployments of
perl, particularly for multi-threaded servers, to see whether all third party
code is compatible with it, as this configuration may give useful performance
improvements. For existing installations we would not recommend changing to
this configuration unless thorough testing is performed before deployment.

=item *

C<chdir>, C<chmod> and C<chown> can now work on filehandles as well as
filenames, if the system supports respectively C<fchdir>, C<fchmod> and
C<fchown>, thanks to a patch provided by Gisle Aas.

=item *

Weak reference creation is now I<O(1)> rather than I<O(n)>, courtesy of
Nicholas Clark. Weak reference deletion remains I<O(n)>, but if deletion only
happens at program exit, it may be skipped completely.

=item *

Salvador Fandiño provided improvements to reduce the memory usage of C<sort>
and to speed up some cases.

=item *

Jarkko Hietaniemi and Andy Lester worked to mark as much data as possible in
the C source files as C<static>, to increase the proportion of the executable
file that the operating system can share between process, and thus reduce
real memory usage on multi-user systems.

=back

=head1 Installation and Configuration Improvements

Parallel makes should work properly now, although there may still be problems
with if C<make test> is instructed to run in parallel.

Building with Borland's compilers on Win32 should work more smoothly. In
particular Steve Hay has worked to side step many warnings emitted by their
compilers and at least one C compiler internal error.

C<Configure> will now detect C<clearenv> and C<unsetenv>, thanks to a patch
from Alan Burlison. It will also probe for C<futimes> and whether C<sprintf>
correctly returns the length of the formatted string, which will both be used
in perl 5.8.9.

There are improved hints for next-3.0, vmesa, IX, Darwin, Solaris, Linux,
DEC/OSF, HP-UX and MPE/iX

=head1 Selected Bug Fixes

=head2 Remove over-optimisation

Perl 5.8.4 introduced a change so that assignments of C<undef> to a
scalar, or of an empty list to an array or a hash, were optimised out. As
this could cause problems when C<goto> jumps were involved, this change
was backed out.

=head2 sprintf() fixes

Using the sprintf() function with some formats could lead to a buffer
overflow in some specific cases. This has been fixed, along with several
other bugs, notably in bounds checking.

In related fixes, it was possible for badly written code that did not follow
the documentation of C<Sys::Syslog> to have formatting vulnerabilities.
C<Sys::Syslog> has been changed to protect people from poor quality third
party code.

=head2 Debugger and Unicode slowdown

It had been reported that running under perl's debugger when processing
Unicode data could cause unexpectedly large slowdowns. The most likely cause
of this was identified and fixed by Nicholas Clark.

=head2 Smaller fixes

=over 4

=item *

C<FindBin> now works better with directories where access rights are more
restrictive than usual.

=item *

Several memory leaks in ithreads were closed. An improved implementation of
C<threads::shared> is available on CPAN - this will be merged into 5.8.9 if
it proves stable.

=item *

Trailing spaces are now trimmed from C<$!> and C<$^E>.

=item *

Operations that require perl to read a process' list of groups, such as reads
of C<$(> and C<$)>, now dynamically allocate memory rather than using a
fixed sized array. The fixed size array could cause C stack exhaustion on
systems configured to use large numbers of groups.

=item *

C<PerlIO::scalar> now works better with non-default C<$/> settings.

=item *

You can now use the C<x> operator to repeat a C<qw//> list. This used
to raise a syntax error.

=item *

The debugger now traces correctly execution in eval("")uated code that
contains #line directives.

=item *

The value of the C<open> pragma is no longer ignored for three-argument
opens.

=item *

The optimisation of C<for (reverse @a)> introduced in perl 5.8.6 could
misbehave when the array had undefined elements and was used in LVALUE
context. Dave Mitchell provided a fix.

=item *

Some case insensitive matches between UTF-8 encoded data and 8 bit regexps,
and vice versa, could give malformed character warnings. These have been
fixed by Dave Mitchell and Yves Orton.

=item *

C<lcfirst> and C<ucfirst> could corrupt the string for certain cases where
the length UTF-8 encoding of the string in lower case, upper case or title
case differed. This was fixed by Nicholas Clark.

=item *

Perl will now use the C library calls C<unsetenv> and C<clearenv> if present
to delete keys from C<%ENV> and delete C<%ENV> entirely, thanks to a patch
from Alan Burlison.

=back

=head1 New or Changed Diagnostics

=head2 Attempt to set length of freed array

This is a new warning, produced in situations such as this:

    $r = do {my @a; \$#a};
    $$r = 503;

=head2 Non-string passed as bitmask

This is a new warning, produced when number has been passed as a argument to
select(), instead of a bitmask.

    # Wrong, will now warn
    $rin = fileno(STDIN);
    ($nfound,$timeleft) = select($rout=$rin, undef, undef, $timeout);
    
    # Should be
    $rin = '';
    vec($rin,fileno(STDIN),1) = 1;
    ($nfound,$timeleft) = select($rout=$rin, undef, undef, $timeout);

=head2 Search pattern not terminated or ternary operator parsed as search pattern

This syntax error indicates that the lexer couldn't find the final
delimiter of a C<?PATTERN?> construct. Mentioning the ternary operator in
this error message makes syntax diagnostic easier.

=head1 Changed Internals

There has been a fair amount of refactoring of the C<C> source code, partly to
make it tidier and more maintainable. The resulting object code and the
C<perl> binary may well be smaller than 5.8.7, in particular due to a change
contributed by Dave Mitchell which reworked the warnings code to be
significantly smaller. Apart from being smaller and possibly faster, there
should be no user-detectable changes.

Andy Lester supplied many improvements to determine which function
parameters and local variables could actually be declared C<const> to the C
compiler. Steve Peters provided new *_set macros and reworked the core to
use these rather than assigning to macros in LVALUE context.

Dave Mitchell improved the lexer debugging output under C<-DT>

Nicholas Clark changed the string buffer allocation so that it is now rounded
up to the next multiple of 4 (or 8 on platforms with 64 bit pointers). This
should reduce the number of calls to C<realloc> without actually using any
extra memory.

The C<HV>'s array of C<HE*>s is now allocated at the correct (minimal) size,
thanks to another change by Nicholas Clark. Compile with
C<-DPERL_USE_LARGE_HV_ALLOC> to use the old, sloppier, default.

For XS or embedding debugging purposes, if perl is compiled with
C<-DDEBUG_LEAKING_SCALARS_FORK_DUMP> in addition to
C<-DDEBUG_LEAKING_SCALARS> then a child process is C<fork>ed just before
global destruction, which is used to display the values of any scalars
found to have leaked at the end of global destruction. Without this, the
scalars have already been freed sufficiently at the point of detection that
it is impossible to produce any meaningful dump of their contents.  This
feature was implemented by the indefatigable Nicholas Clark, based on an idea
by Mike Giroux.

=head1 New Tests

=head1 Known Problems

=head1 Platform Specific Problems

The optimiser on HP-UX 11.23 (Itanium 2) is currently partly disabled (scaled 
down to +O1) when using HP C-ANSI-C; the cause of problems at higher
optimisation levels is still unclear.

=head1 Reporting Bugs

If you find what you think is a bug, you might check the articles
recently posted to the comp.lang.perl.misc newsgroup and the perl
bug database at http://bugs.perl.org.  There may also be
information at http://www.perl.org, the Perl Home Page.

If you believe you have an unreported bug, please run the B<perlbug>
program included with your release.  Be sure to trim your bug down
to a tiny but sufficient test case.  Your bug report, along with the
output of C<perl -V>, will be sent off to perlbug@perl.org to be
analysed by the Perl porting team.  You can browse and search
the Perl 5 bugs at http://bugs.perl.org/

=head1 SEE ALSO

The F<Changes> file for exhaustive details on what changed.

The F<INSTALL> file for how to build Perl.

The F<README> file for general stuff.

The F<Artistic> and F<Copying> files for copyright information.

=cut
