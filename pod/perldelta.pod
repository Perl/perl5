=encoding utf8

=head1 NAME

[ this is a template for a new perldelta file. Any text flagged as
XXX needs to be processed before release. ]

perldelta - what is new for perl v5.13.10

=head1 DESCRIPTION

This document describes differences between the 5.XXX.XXX release and
the 5.XXX.XXX release.

If you are upgrading from an earlier release such as 5.YYY.YYY, first read
L<perl5YYYdelta>, which describes differences between 5.ZZZ.ZZZ and
5.YYY.YYY.

=head1 Notice

XXX Any important notices here

=head1 Core Enhancements

XXX New core language features go here. Summarise user-visible core language
enhancements. Particularly prominent performance optimisations could go
here, but most should go in the L</Performance Enhancements> section.

[ List each enhancement as a =head2 entry ]

=head2 Add C<\p{Titlecase}> as a synonym for C<\p{Title}>

This synonym is added for symmetry with the Unicode property names
C<\p{Uppercase}> and C<\p{Lowercase}>.

=head2 New regular expression modifier option C</aa>

Doubling the C</a> regular expression modifier increases its effect,
so that in case-insensitive matching, no ASCII character will match a
non-ASCII character.  For example, normally,

    'k' =~ /\N{KELVIN SIGN}/

will match; it won't under C</aa>.  Note that like C</a>, C</aa>
in 5.14 will not actually be able to be used as a suffix at the end of a
regular expression.

=head1 Security

XXX Any security-related notices go here.  In particular, any security
vulnerabilities closed should be noted here rather than in the
L</Selected Bug Fixes> section.

[ List each security issue as a =head2 entry ]

=head1 Incompatible Changes

XXX For a release on a stable branch, this section aspires to be:

    There are no changes intentionally incompatible with 5.XXX.XXX. If any
    exist, they are bugs and reports are welcome.

[ List each incompatible change as a =head2 entry ]

=head2 Most C<\p{}> properties are now immune from case-insensitive matching

For most Unicode properties, it doesn't make sense to have them match
differently under C</i> case-insensitive matching than not.  And doing
so leads to unexpected results and potential security holes.  For
example

 m/\p{ASCII_Hex_Digit}+/i

could previously match non-ASCII characters because of the Unicode
matching rules.  There were a number of bugs in this feature until an
earlier release in the 5.13 series.  Now this release reverts, and
removes the feature completely except for the few properties where
people have come to expect it, namely the ones where casing is an
integral part of their functionality, such as C<m/\p{Uppercase}/i> and
C<m/\p{Lowercase}/i>, both of which match the exact same code points,
namely those matched by C<m/\p{Cased}/i>.  Details are in
L<perlrecharclass/Unicode Properties>.

User-defined property handlers that need to match differently under
C</i> must change to read the new boolean parameter passed it which is
non-zero if case-insensitive matching is in effect; 0 if not.  See
L<perluniprops/User-Defined Character Properties>.

=head2 [perl #82996] Use the user's from address as return-path in perlbug

Many systems these days don't have a valid Internet domain name and
perlbug@perl.org does not accept email with a return-path that does
not resolve. Therefore pass the user's address to sendmail so it's
less likely to get stuck in a mail queue somewhere. (019cfd2)

=head2 regex: \p{} in pattern implies Unicode semantics

Now, a Unicode property match specified in the pattern will indicate
that the pattern is meant for matching according to Unicode rules
(e40e74f)

=head2 add GvCV_set() and GvGP_set() macros and change GvGP()

This allows a future commit to eliminate some backref magic between GV
and CVs, which will require complete control over assignment to the
gp_cv slot.

If you've been using GvGP() in lvalue context this change will break
your code, you should use GvGP_set() instead. (c43ae56)

=head2 _swash_inversion_hash is no longer exported as part of the API

This function shouldn't be called from XS code. (4c2e113)

=head2 Unreferenced objects in global destruction

The fix for [perl #36347], which made sure that destructors were called on
unreferenced objects, broke the tests for three CPAN modules, which
apparently rely on the bug.

To provide more time for fixing them (as this is such a minor bug), we
have reverted the fix until after perl 5.14.0.

This resolves [perl #82542] and other related tickets.

=head2 C<close> on shared pipes

The C<close> function no longer waits for the child process to exit if the
underlying file descriptor is still in use by another thread, to avoid
deadlocks. It returns true in such cases.

=head1 Deprecations

XXX Any deprecated features, syntax, modules etc. should be listed here.
In particular, deprecated modules should be listed here even if they are
listed as an updated module in the L</Modules and Pragmata> section.

=head2 User-defined case-mapping

This feature is being deprecated due to its many issues, as documented in
L<perlunicode/User-Defined Case Mappings (for serious hackers only)>.
It is planned to remove this feature in Perl 5.16.  A CPAN module
providing improved functionality is being prepared for release by the
time 5.14 is.

[ List each deprecation as a =head2 entry ]

=head1 Performance Enhancements

XXX Changes which enhance performance without changing behaviour go here. There
may well be none in a stable release.

[ List each enhancement as a =item entry ]

=over 4

=item *

XXX

=back

=head1 Modules and Pragmata

XXX All changes to installed files in F<cpan/>, F<dist/>, F<ext/> and F<lib/>
go here.  If Module::CoreList is updated, generate an initial draft of the
following sections using F<Porting/corelist-perldelta.pl>, which prints stub
entries to STDOUT.  Results can be pasted in place of the '=head2' entries
below.  A paragraph summary for important changes should then be added by hand.
In an ideal world, dual-life modules would have a F<Changes> file that could be
cribbed.

[ Within each section, list entries as a =item entry ]

=head2 New Modules and Pragmata

=over 4

=item *

C<CPAN::Meta> version 2.110440 has been added as a dual-life module. It
provides a standard library to read, interpret and write CPAN distribution
metadata files (e.g. META.json and META.yml) which describes a
distribution, its contents, and the requirements for building it and
installing it. The latest CPAN distribution metadata specification is
included as C<CPAN::Meta::Spec> and notes on changes in the specification
over time are given in C<CPAN::Meta::History>.

=item *

C<Version::Requirements> version 0.101020 has been added as a dual-life
module.  It provides a standard library to model and manipulates module
prerequisites and version constraints as defined in the L<CPAN::Meta::Spec>.

=back

=head2 Updated Modules and Pragmata

=over 4

=item *

C<B> has been upgraded from version 1.27 to 1.28.

=item *

C<Carp> has been upgraded from version 1.19 to 1.20.

[perl #82854] It now avoids using regular expressions that cause perl to
load its Unicode tables, in order to avoid the 'BEGIN not safe after
errors' error that will ensue if there has been a syntax error.

=item *

C<CGI> has been upgraded from version 3.51 to 3.52

=item *

C<CPAN> has been upgraded from version 1.94_64 to 1.94_65

Includes support for META.json and MYMETA.json.

=item *

C<CPANPLUS> has been upgraded from version 0.9011 to 0.9101

Includes support for META.json and MYMETA.json and a change to
using Digest::SHA for CPAN checksums.

=item *

C<diagnostics> has been upgraded from version 1.21 to 1.22.

It now renders pod links slightly better, and has been taught to find
descriptions for messages that share their descriptions with other
messages.

=item *

C<IO::Select> has been upgraded from version 1.17 to 1.18.

It now allows IO::Handle objects (and objects in derived classes) to be
removed from an IO::Select set even if the underlying file descriptor is
closed or invalid.

=item *

C<IPC::Cmd> has been upgraded from version 0.68 to 0.70

=item *

C<HTTP::Tiny> has been upgraded from version 0.009 to 0.010

=item *

C<Math::BigInt> has been upgraded from version 1.99_04 to 1.991.

=item *

C<Module::Build> has been upgraded from version 0.3607 to 0.37_04.

A notable change is the deprecation of several modules.
Module::Build::Version has been deprecated and Module::Build now relies
directly upon L<version>.  Module::Build::ModuleInfo has been deprecated in
favor of a standalone copy of it called L<Module::Metadata>.
Module::Build::YAML has been deprecated in favor of L<CPAN::Meta::YAML>.

Module::Build now also generates META.json and MYMETA.json files
in accordance with version 2 of the CPAN distribution metadata specification,
L<CPAN::Meta::Spec>.  The older format META.yml and MYMETA.yml files are
still generated, as well.

=item *

C<Module::Load::Conditional> has been upgraded from version 0.40 to 0.44

=item *

C<Module::Metadata> has been upgraded from version 1.000003 to 1.000004.

=item *

C<overload> has been upgraded from version 1.12 to 1.13.

The documentation has greatly improved. See L</Documentation> below.

=item *

C<Parse::CPAN::Meta> has been upgraded from version 1.40 to 1.4401.

The latest Parse::CPAN::Meta can now read YAML or JSON files using
L<CPAN::Meta::YAML> and L<JSON::PP>, which are now part of the Perl core.

=item *

C<re> has been upgraded from version 0.16 to 0.17.

It now supports the double-a flag: C<use re '/aa';>

=item *

C<Term::UI> has been upgraded from version 0.24 to 0.26

=item *

C<Unicode::Collate> has been upgraded from version 0.68 to 0.72

This also sees the switch from using the pure-perl version of this
module to the XS version.`

=item *

C<VMS::DCLsym> has been upgraded from version 1.04 to 1.05.

Two bugs have been fixed [perl #84086]:

The symbol table name was lost when tying a hash, due to a thinko in
C<TIEHASH>. The result was that all tied hashes interacted with the
local symbol table.

Unless a symbol table name had been explicitly specified in the call
to the constructor, querying the special key ':LOCAL' failed to
identify objects connected to the local symbol table.

=item *

Added new function C<Unicode::UCD::num()>.  This function will return the
numeric value of the string passed it; C<undef> if the string in its
entirety has no safe numeric value.

To be safe, a string must be a single character which has a numeric
value, or consist entirely of characters that match \d, coming from the
same Unicode block of digits.  Thus, a mix of  Bengali and Western
digits would be considered unsafe, as well as a mix of half- and
full-width digits, but strings consisting entirely of Devanagari digits
or of "Mathematical Bold" digits would would be safe.

=item *

C<CPAN> has been upgraded from version1.94_63 to 1.94_64.

=item *

XXX

=back

=head2 Removed Modules and Pragmata

=over 4

=item *

XXX

=back

=head1 Documentation

XXX Changes to files in F<pod/> go here.  Consider grouping entries by
file and be sure to link to the appropriate page, e.g. L<perlfunc>.

=head2 New Documentation

XXX Changes which create B<new> files in F<pod/> go here.

=head3 L<XXX>

XXX Description of the purpose of the new file here

=head2 Changes to Existing Documentation

XXX Changes which significantly change existing files in F<pod/> go here.
However, any changes to F<pod/perldiag.pod> should go in the L</Diagnostics>
section.

=head3 L<overload>

=over 4

=item *

L<overload>'s documentation has practically undergone a rewrite. It
is now much more straightforward and clear.

=back

=head3 L<perlhack> and perlrepository

=over 4

=item *

The L<perlhack> and perlrepository documents have been heavily edited and
split up into several new documents.

The L<perlhack> document is now much shorter, and focuses on the Perl 5
development process and submitting patches to Perl. The technical content has
been moved to several new documents, L<perlsource>, L<perlinterp>,
L<perlhacktut>, and L<perlhacktips>. This technical content has only been
lightly edited.

The perlrepository document has been renamed to L<perlgit>. This new document
is just a how-to on using git with the Perl source code. Any other content
that used to be in perlrepository has been moved to perlhack.

=back

=head3 L<perlfunc>

=over 4

=item *

The documentation for the C<map> function now contains more examples,
see B<perldoc -f map> (f947627)

=back

=head3 L<perlfaq4>

=over 4

=item *

Examples in L<perlfaq4> have been updated to show the use of
L<Time::Piece>. (9243591)

=back

=head3 Miscellaneous

=over 4

=item *

Many POD related RT bugs and other issues which are too numerous to
enumerate have been solved by Michael Stevens.

=back

=head1 Diagnostics

The following additions or changes have been made to diagnostic output,
including warnings and fatal error messages.  For the complete list of
diagnostic messages, see L<perldiag>.

XXX New or changed warnings emitted by the core's C<C> code go here. Also
include any changes in L<perldiag> that reconcile it to the C<C> code.

[ Within each section, list entries as a =item entry ]

=head2 New Diagnostics

XXX Newly added diagnostic messages go here

=over 4

=item "\b{" is deprecated; use "\b\{" instead

=item "\B{" is deprecated; use "\B\{" instead

Use of an unescaped "{" immediately following a C<\b> or C<\B> is now
deprecated so as to reserve its use for Perl itself in a future release.

=item regcomp: Add warning if \p is used under locale. (fb2e24c)

C<\p> implies Unicode matching rules, which are likely going to be
different than the locale's.

=item panic: gp_free failed to free glob pointer - something is repeatedly re-creating entries

This new error is triggered if a destructor called on an object in a
typeglob that is being freed creates a new typeglob entry containing an
object with a destructor that creates a new entry containing an object....

=item refcnt: fd %d%s

This new error only occurs if a internal consistency check fails when a
pipe is about to be closed.

=back

=head2 Changes to Existing Diagnostics

XXX Changes (i.e. rewording) of diagnostic messages go here

=over 4

=item *

The warning message about regex unrecognized escapes passed through is
changed to include any literal '{' following the 2-char escape.  e.g.,
"\q{" will include the { in the message as part of the escape
(216bfc0).

=item * C<binmode $fh, ':scalar'> no longer warns (8250589)

Perl will now no longer produce this warning:

    $ perl -we 'open my $f, ">", \my $x; binmode $f, "scalar"'
    Use of uninitialized value in binmode at -e line 1.

=item *

XXX

=back

=head1 Utility Changes

XXX Changes to installed programs such as F<perlbug> and F<xsubpp> go
here. Most of these are built within the directories F<utils> and F<x2p>.

[ List utility changes as a =head3 entry for each utility and =item
entries for each change
Use L<XXX> with program names to get proper documentation linking. ]

=head3 L<XXX>

=over 4

=item *

XXX

=back

=head1 Configuration and Compilation

XXX Changes to F<Configure>, F<installperl>, F<installman>, and analogous tools
go here.  Any other changes to the Perl build process should be listed here.
However, any platform-specific changes should be listed in the
L</Platform Support> section, instead.

[ List changes as a =item entry ].

=over 4

=item * make reg_eval_scope.t TODOs consistently fail (daaf7ac)

Some of the TODO tests in reg_eval_scope.t spuriously passed under
non-threaded builds. Make the tests harder so they always fail.

Since one of the key bugs in (?{..}) is the trashing of the parent pad,
add some extra lexical vars to the parent scope and check they're still
there at the end.

=item *

Stop EU::CBuilder's tests from failing in parallel (cbf59d5)

It used to use the same paths for temporary files in all tests. This
blew up randomly when the tests were run in parallel.

=item *

XXX

=back

=head1 Testing

XXX Any significant changes to the testing of a freshly built perl should be
listed here.  Changes which create B<new> files in F<t/> go here as do any
large changes to the testing harness (e.g. when parallel testing was added).
Changes to existing files in F<t/> aren't worth summarising, although the bugs
that they represent may be covered elsewhere.

[ List each test improvement as a =item entry ]

=over 4

=item *

F<porting/FindExt.t> now skips all tests on a static (-Uusedl) build
of perl.

=item *

F<porting/FindExt.t> now passes on non-Win32 platforms when some
extensions are built statically.

=back

=head1 Platform Support

XXX Any changes to platform support should be listed in the sections below.

[ Within the sections, list each platform as a =item entry with specific
changes as paragraphs below it. ]

=head2 New Platforms

XXX List any platforms that this version of perl compiles on, that previous
versions did not. These will either be enabled by new files in the F<hints/>
directories, or new subdirectories and F<README> files at the top level of the
source tree.

=over 4

=item XXX-some-platform

XXX

=back

=head2 Discontinued Platforms

XXX List any platforms that this version of perl no longer compiles on.

=over 4

=item XXX-some-platform

XXX

=back

=head2 Platform-Specific Notes

XXX List any changes for specific platforms. This could include configuration
and compilation changes or changes in portability/compatibility.  However,
changes within modules for platforms should generally be listed in the
L</Modules and Pragmata> section.

=over 4

=item Windows

=over 4

=item *

The C<test-prep> build target now depends on F<pod/perltoc.pod> to allow the
F<t/porting/buildtoc.t> test to run successfully.

=back

=item MirBSD

=over 4

=item *

[perl #82988] Skip hanging taint.t test on MirBSD 10 (1fb83d0)

Skip a hanging test under MirBSD that was already being skipped under
OpenBSD.

=item *

Previously if you build perl with a shared libperl.so on MirBSD (the
default config), it will work up to the installation; however, once
installed, it will be unable to find libperl. Treat path handling
like in the other BSD dialects.

=back

=back

=head1 Internal Changes

XXX Changes which affect the interface available to C<XS> code go here.
Other significant internal changes for future core maintainers should
be noted as well.

[ List each test improvement as a =item entry ]

=over 4

=item * Fix harmless invalid read in Perl_re_compile() (f6d9469)

[perl #2460] described a case where electric fence reported an invalid
read. This could be reproduced under valgrind with blead and -e'/x/',
but only on a non-debugging build.

This was because it was checking for certain pairs of nodes (e.g. BOL + END)
and wasn't allowing for EXACT nodes, which have the string at the next
node position when using a naive NEXTOPER(first). In the non-debugging
build, the nodes aren't initialised to zero, and a 1-char EXACT node isn't
long enough to spill into the type field of the "next node".

Fix this by only using NEXTOPER(first) when we know the first node is
kosher.

=item * Break out the generated function Perl_keywords() into F<keywords.c>, a new file. (26ea9e1)

As it and Perl_yylex() both need FEATURE_IS_ENABLED, feature_is_enabled() is
no longer static, and the two macro definitions move from toke.c to perl.h

Previously, one had to cut and paste the output of perl_keywords.pl into the
middle of toke.c, and it was not clear that it was generated code.

=item *

A lot of tests have been ported from Test to Test::More, e.g. in
3842ad6.

=item *

XXX

=back

=head1 Selected Bug Fixes

XXX Important bug fixes in the core language are summarised here.
Bug fixes in files in F<ext/> and F<lib/> are best summarised in
L</Modules and Pragmata>.

[ List each fix as a =item entry ]

=over 4

=item *

A Unicode C<\p{}> property match in a regular expression pattern will
now force Unicode rules for the rest of the regular expression

=item *

[perl #38456] binmode FH, ":crlf" only modifies top crlf layer (7826b36)

When pushed on top of the stack, crlf will no longer enable crlf layers
lower in the stack. This will prevent unexpected results.

=item *

Fix 'raw' layer for RT #80764 (ecfd064)

Made a ':raw' open do what it advertises to do (first open the file,
then binmode it), instead of leaving off the top layer.

=item *

Use PerlIOBase_open for pop, utf8 and bytes layers (c0888ac)

Three of Perl's builtin PerlIO layers (C<:pop>, C<:utf8> and
C<:bytes>) didn't allow stacking when opening a file. For example
this:

    open FH, '>:pop:perlio', 'some.file' or die $!;

Would throw an error: "Invalid argument". This has been fixed in this
release.

=item *

An issue present since 5.13.1, where s/A/B/ with A utf8 and B
non-utf8, could cause corruption or segfaults has been
fixed. (c95ca9b)

=item *

String evals will no longer fail after 2 billion scopes have been
compiled (d1bfb64, 2df5bdd, 0d311cd and 6012dc8)

=item *

[perl #81750] When strict 'refs' mode is off,
C<%{...}> in rvalue context returns C<undef> if
its argument is undefined. An optimisation introduced in perl 5.12.0 to
make C<keys %{...}> faster when used as a boolean did not take this into
account, causing C<keys %{+undef}> (and C<keys %$foo> when C<$foo> is
undefined) to be an error, which it should only be in strict mode.

=item *

[perl #83194] Combining the vector (%v) flag and dynamic precision would
cause sprintf to confuse the order of its arguments, making it treat the
string as the precision and vice versa.

=item *

[perl #77692] Sometimes the UTF8 length cache would not be reset on a value
returned by substr, causing C<length(substr($uni_string,...))> to give
wrong answers. With C<${^UTF8CACHE}> set to -1, it would produce a 'panic'
error message, too.

=item *

During the restoration of a localised typeglob on scope exit, any
destructors called as a result would be able to see the typeglob in an
inconsistent state, containing freed entries, which could result in a
crash. This would affect code like this:

  local *@;
  eval { die bless [] }; # puts an object in $@
  sub DESTROY {
    local $@; # boom
  }

Now the glob entries are cleared before any destructors are called. This
also means that destructors can vivify entries in the glob. So perl tries
again and, if the entries are re-created too many times, dies with a
'panic: gp_free...' error message.

=item *

[perl #78494] When pipes are shared between threads, the C<close> function
(and any implicit close, such as on thread exit) no longer blocks.

=back

=head1 Known Problems

XXX Descriptions of platform agnostic bugs we know we can't fix go here. Any
tests that had to be C<TODO>ed for the release would be noted here, unless
they were specific to a particular platform (see below).

This is a list of some significant unfixed bugs, which are regressions
from either 5.XXX.XXX or 5.XXX.XXX.

[ List each fix as a =item entry ]

=over 4

=item *

XXX

=back

=head1 Obituary

XXX If any significant core contributor has died, we've added a short obituary
here.

=head1 Acknowledgements

XXX The list of people to thank goes here.

=head1 Reporting Bugs

If you find what you think is a bug, you might check the articles
recently posted to the comp.lang.perl.misc newsgroup and the perl
bug database at http://rt.perl.org/perlbug/ .  There may also be
information at http://www.perl.org/ , the Perl Home Page.

If you believe you have an unreported bug, please run the L<perlbug>
program included with your release.  Be sure to trim your bug down
to a tiny but sufficient test case.  Your bug report, along with the
output of C<perl -V>, will be sent off to perlbug@perl.org to be
analysed by the Perl porting team.

If the bug you are reporting has security implications, which make it
inappropriate to send to a publicly archived mailing list, then please send
it to perl5-security-report@perl.org. This points to a closed subscription
unarchived mailing list, which includes all the core committers, who be able
to help assess the impact of issues, figure out a resolution, and help
co-ordinate the release of patches to mitigate or fix the problem across all
platforms on which Perl is supported. Please only use this address for
security issues in the Perl core, not for modules independently
distributed on CPAN.

=head1 SEE ALSO

The F<Changes> file for an explanation of how to view exhaustive details
on what changed.

The F<INSTALL> file for how to build Perl.

The F<README> file for general stuff.

The F<Artistic> and F<Copying> files for copyright information.

=cut
